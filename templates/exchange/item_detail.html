<!-- exchange/templates/exchange/item_detail.html -->

{% extends 'exchange/base.html' %}
{% load static %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'css/item_detail.css' %}">
{% endblock %}

{% block content %}

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
 </head>

<!-- Header Section -->
<header class="site-header">
    <div class="container header-container">
       <div class="left-header">
          <a href="{% url 'exchange:homepage' %}" class="logo">
             <img src="{% static 'images/logoheaderdark.png' %}" alt="SwapSpot Logo" class="logo-image">
          </a>
          
          <!-- Search Form -->
          <form method="GET" action="{% url 'exchange:homepage' %}" class="search-bar">
             <input type="text" name="q" placeholder="Search" class="search-input" value="{{ request.GET.q }}">
          </form>
          
       </div>
       
       <div class="user-profile" onclick="toggleDropdown()">
          {% if user.profile_picture %}
             <img src="{{ user.profile_picture.url }}" alt="Profile Picture">
          {% else %}
             <img src="{% static 'images/defaultpfp.png' %}" alt="Profile Picture">
          {% endif %}
          
          <!-- Username Display -->
          <span class="user-name">
             {{ user.username }}
          </span>
          
          <div class="dropdown-menu" id="dropdownMenu">
             <ul>
                <li><a href="{% url 'exchange:user_profile' username=user.username %}">Profile</a></li>
                <li><a href="{% url 'exchange:user_profile_settings' %}">Settings</a></li>
                <li><a href="{% url 'exchange:logout' %}">Logout</a></li>
             </ul>
          </div>
       </div>
    </div>
 </header>

<div class="item-detail-container">
    <!-- Item Image Section -->
    <div class="item-image-section">
        {% if item.images.all %}
            <div class="image-slider">
                {% for image in item.images.all %}
                    <img src="{{ image.image.url }}" alt="{{ item.title }} Image {{ forloop.counter }}" class="item-image">
                {% endfor %}
            </div>
        {% elif item.picture %}
            <img src="{{ item.picture.url }}" alt="{{ item.title }}" class="item-image">
        {% else %}
            <img src="{% static 'images/default_item.png' %}" alt="Default Item Image" class="item-image">
        {% endif %}
    </div>

    <!-- Item Information Section -->
    <div class="item-info-section">
        <h1 class="item-title">{{ item.title }}</h1>
        <p class="item-price">PHP {{ item.price }}</p>
        
        <!-- Category and Condition -->
        <p class="item-category"><strong>Category:</strong> {{ item.category }}</p>
        <p class="item-condition"><strong>Condition:</strong> {{ item.condition }}</p>
        
        <!-- Listing Type and Availability -->
        <p class="item-listing-type"><strong>Listing Type:</strong> {{ item.listing_type }}</p>

        <!-- Description -->
        <div class="item-description">
            <h3>Description</h3>
            <p>{{ item.description }}</p>
        </div>

        <!-- Location -->
        <p class="item-location">
            <strong>Location:</strong>
            {% if item.user.city and item.user.state %}
                {{ item.user.city }}, {{ item.user.state }}
            {% elif item.user.city %}
                {{ item.user.city }}
            {% elif item.user.state %}
                {{ item.user.state }}
            {% else %}
                Not specified
            {% endif %}
        </p>

        <!-- Date Listed -->
        <p class="item-date-listed">
            <strong>Listed On:</strong> {{ item.date_listed|date:"F j, Y, g:i a" }}
        </p>

        <!-- Seller Information -->
        <div class="seller-info-section">
          <h3>Seller Information</h3>
          <div class="seller-details">
              <a href="{% url 'exchange:user_profile' username=item.user.username %}">
                  {% if item.user.profile_picture %}
                      <img src="{{ item.user.profile_picture.url }}" alt="{{ item.user.username }}" class="seller-pfp">
                  {% else %}
                      <img src="{% static 'images/defaultpfp.png' %}" alt="{{ item.user.username }}" class="seller-pfp">
                  {% endif %}
              </a>
              <a href="{% url 'exchange:user_profile' username=item.user.username %}" class="seller-username">
                  {{ item.user.username }}
              </a>
          </div>
        </div>

        <!-- Actions -->
        <div class="item-actions">
          {% if is_owner %}
              <!-- Display Edit and Delete buttons for the owner -->
              <button class="button edit-item-btn" onclick="openModal()">Edit Item</button>
              <!-- The Modal -->
                <!-- The Modal -->
                  <div id="editItemModal" class="modal">
                    <!-- Modal content -->
                    <div class="modal-content">
                      <span class="close" onclick="closeModal()">&times;</span>
                      <div class="modal-header">
                        <h2>Edit Item</h2>
                      </div>
                      <div class="modal-body">
                        <!-- Display form errors here -->
                        <form id="editItemForm" action="{% url 'exchange:edit_item' item_id=item.item_id %}" method="post" enctype="multipart/form-data">
                          {% csrf_token %}
                          {{ form.non_field_errors }}
                    
                          <!-- Title -->
                          <p>
                            {{ form.title.label_tag }}
                            {{ form.title }}
                            {{ form.title.errors }}
                          </p>
                    
                          <!-- Description -->
                          <p>
                            {{ form.description.label_tag }}
                            {{ form.description }}
                            {{ form.description.errors }}
                          </p>
                    
                          <!-- Category -->
                          <p>
                            {{ form.category.label_tag }}
                            {{ form.category }}
                            {{ form.category.errors }}
                          </p>
                    
                          <!-- Condition -->
                          <p>
                            {{ form.condition.label_tag }}
                            {{ form.condition }}
                            {{ form.condition.errors }}
                          </p>
                    
                          <!-- Price -->
                          <p>
                            {{ form.price.label_tag }}
                            {{ form.price }}
                            {{ form.price.errors }}
                          </p>
                    
                          <!-- Listing Type -->
                          <p>
                            {{ form.listing_type.label_tag }}
                            {{ form.listing_type }}
                            {{ form.listing_type.errors }}
                          </p>
                    
                          <!-- Picture -->
                          <p>
                            {{ form.picture.label_tag }}
                            {{ form.picture }}
                            {{ form.picture.errors }}
                          </p>
                    
                          <div class="modal-footer">
                            <button type="submit">Save Changes</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
      
              <!-- Delete Item Form -->
              <form action="{% url 'exchange:delete_item' item_id=item.item_id %}" method="post" style="display:inline;">
                  {% csrf_token %}
                  <button type="submit" class="button delete-item-btn" onclick="return confirm('Are you sure you want to delete this item?');">Delete Item</button>
              </form>
          {% else %}
              <!-- Display Send Offer button for other users -->
              <button class="button send-offer-btn">Send Offer</button>
          {% endif %}
      </div>
    </div>
</div>

<!-- Footer Section -->
<footer class="site-footer">
   <div class="footer-container">
 
     <!-- Logo and Company Info -->
     <div class="footer-section logo-section">
       <img alt="SwapSpot Logo" class="footer-logo" src="{% static 'images/logoheaderdark.png' %}">
       <p class="copyright">Â© 2024 All rights reserved.</p>
       <p class="company-info">SwapSpot Company, Cebu City.</p>
     </div>
 
     <!-- Sitemap Section -->
     <div class="footer-section sitemap">
       <h3>Sitemap</h3>
       <ul>
         <li><a href="#">About Us</a></li>
         <li><a href="#">Our Goals</a></li>
         <li><a href="#">Our Pledge</a></li>
         <li><a href="#">Contact</a></li>
       </ul>
     </div>
 
     <!-- Products Section -->
     <div class="footer-section products">
       <h3>Products</h3>
       <ul>
         <li><a href="#">How Bartering Works</a></li>
         <li><a href="#">User Rating System</a></li>
         <li><a href="#">Customer Protection</a></li>
       </ul>
     </div>
 
     <!-- Help Section -->
     <div class="footer-section help">
       <h3>Help</h3>
       <ul>
         <li><a href="#">Getting Started</a></li>
         <li><a href="#">FAQ</a></li>
         <li><a href="#">Referral Program</a></li>
         <li><a href="#">Customer Support</a></li>
       </ul>
     </div>
 
     <!-- Social Media Section -->
     <div class="footer-section social-media">
       <a href="#" rel="noopener noreferrer" target="_blank" aria-label="Facebook">
         <img alt="Facebook" class="social-icon" src="{% static 'svg/facebook-icon.svg' %}">
       </a>
       <a href="#" rel="noopener noreferrer" target="_blank" aria-label="Instagram">
         <img alt="Instagram" class="social-icon" src="{% static 'svg/instagram-icon.svg' %}">
       </a>
       <a href="#" rel="noopener noreferrer" target="_blank" aria-label="Twitter">
         <img alt="Twitter" class="social-icon" src="{% static 'svg/twitter-icon.svg' %}">
       </a>
     </div>
 
   </div>
 </footer>

 <script src="{% static 'js/item_detail.js' %}"></script>

{% endblock %}