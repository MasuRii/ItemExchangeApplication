{% extends 'exchange/base.html' %}
{% load static %}
{% block page_css %}
<link rel="stylesheet" href="{% static 'css/homepage.css' %}">
{% endblock %}

{% block content %}
<head>
   <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
   <script defer>
      // Function to toggle the dropdown visibility
      function toggleDropdown() {
          const dropdown = document.getElementById('dropdownMenu');
          dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
      }
      
      // Close the dropdown if the user clicks anywhere outside the user profile
      document.addEventListener('click', function(event) {
          const profile = document.querySelector('.user-profile');
          const dropdown = document.getElementById('dropdownMenu');
          if (!profile.contains(event.target)) {
              dropdown.style.display = 'none';
          }
      });
   </script>
</head>

<!-- Header Section -->
<header class="site-header">
   <div class="container header-container">
      <div class="left-header">
         <a href="{% url 'exchange:homepage' %}" class="logo">
            <img src="{% static 'images/logoheaderdark.png' %}" alt="SwapSpot Logo" class="logo-image">
         </a>
         
         <!-- Search Form -->
         <form method="GET" action="{% url 'exchange:homepage' %}" class="search-bar">
            <input type="text" name="q" placeholder="Search" class="search-input" value="{{ request.GET.q }}">
         </form>
         
      </div>
      
      <div class="user-profile" onclick="toggleDropdown()">
         {% if user.profile_picture %}
            <img src="{{ user.profile_picture.url }}" alt="Profile Picture">
         {% else %}
            <img src="{% static 'images/defaultpfp.png' %}" alt="Profile Picture">
         {% endif %}
         
         <!-- Username Display -->
         <span class="user-name">
            {{ user.username }}
         </span>
         
         <div class="dropdown-menu" id="dropdownMenu">
            <ul>
               <li><a href="{% url 'exchange:user_profile' username=user.username %}">Profile</a></li>
               <li><a href="{% url 'exchange:user_profile_settings' %}">Settings</a></li>
               <li><a href="{% url 'exchange:logout' %}">Logout</a></li>
            </ul>
         </div>
      </div>
   </div>
</header>

<!-- Conditionally Render Hero or Omit -->
{% if not query %}
<section class="hero">
   <div class="hero-slideshow">
      <div class="slide">
         <img src="{% static 'images/image1.png' %}" alt="firstphoto">
      </div>
      <div class="slide">
         <img src="{% static 'images/image2.png' %}" alt="secondphoto">
      </div>
   </div>
</section>
{% endif %}

<!-- Listings Section: Top Listings or Search Results -->
<section class="top-listings">
   <div class="container">
      {% if query %}
         <h2>Showing results for: "{{ query }}"</h2>
      {% else %}
         <h2>Top Listings Near You</h2>
      {% endif %}
      
      <div class="product-grid">
         {% for item in items %}
         <div class="product-card">
            <!-- Link to Item Detail Page -->
            <a href="{% url 'exchange:item_detail' item_id=item.item_id %}" class="product-link">
               
               <!-- Display item picture if available, else show a default image -->
               {% if item.picture %}
                  <img class="product-card-img" src="{{ item.picture.url }}" alt="{{ item.title }}">
               {% else %}
                  <img class="product-card-img" src="{% static 'images/default_item.png' %}" alt="Default Item Image">
               {% endif %}
               
               <div class="card-content">
                  <p class="title">{{ item.title }}</p>
                  <p class="price">PHP {{ item.price }}</p>
                  <p class="location">
                     {% if item.user.city and item.user.state %}
                        {{ item.user.city }}, {{ item.user.state }}
                     {% elif item.user.city %}
                        {{ item.user.city }}
                     {% elif item.user.state %}
                        {{ item.user.state }}
                     {% else %}
                        Location not specified
                     {% endif %}
                  </p>
               </div>
            </a> <!-- Close the link here -->
            <div class="card-actions">
               <button class="send-offer-btn">Send Offer</button>
            </div>
         </div>
         {% empty %}
         <p>No items available{% if query %} matching your search{% endif %}.</p>
         {% endfor %}
      </div>
   </div>
</section>

<!-- Footer Section -->
{% if not query %}
<footer class="site-footer">
   <div class="container footer-container">
      <div class="footer-left">
         <a href="{% url 'exchange:homepage' %}" class="footer-logo">
         <img src="{% static 'svg/swapspot-logo-light.svg' %}" alt="SwapSpot Logo" class="logo-image">
         </a>
         <p>&copy; 2023 SwapSpot. All rights reserved.</p>
      </div>
   </div>
</footer>
{% endif %}
{% endblock %}